---
- name: Configure new VM to be comfortable to use
  hosts: vms
  gather_facts: false
  become: yes
  tasks:
    - name: Install useful vim configurations
      copy:
        dest: ~/.vimrc
        content: |
            :set number
            :set shiftwidth=2
            :set tabstop=2
            :set autoindent
            :set smartindent 
            :set paste
            
    - name: Setup useful aliases
      copy:
        dest: ~/.bashrc
        content: |
            # .bashrc
            
            # Bash prompt configuration
            source ~/pureline/pureline ~/.pureline.conf

            # User specific aliases and functions
            
            alias rm='rm -i'
            alias cp='cp -i'
            alias mv='mv -i'
            
            # Source global definitions
            if [ -f /etc/bashrc ]; then
                    . /etc/bashrc
            fi
            
            alias py=python
            alias la="ls -lAh"
            alias sl=ls
            
            alias start="systemctl start"
            alias stop="systemctl stop"
            alias status="systemctl status"
            alias restart="systemctl restart"
            alias enable="systemctl enable"
            alias disable="systemctl disable"
            alias services="systemctl list-units -t service"
            
            alias pods="kubectl get po"
            alias watch="watch -n 1 "
            alias events="kubectl get events --sort-by=.metadata.creationTimestamp"
            alias kubectl="minikube kubectl --"
            alias kc=kubectl
            alias jc=journalctl
            alias ka=kubeadm
            alias mk=minikube
            alias ipa="ip -brief a"
            
            function run() {
              if [ -z $1 ] || [ -z $2 ]
              then
                echo Usage: run [POD_NAME] [COMMAND]
              else
                kc exec -it $1 -- "$2"
              fi
            }
            
            function editi() {
              if [ -z $1 ]
              then
                echo Usage: editi [NETWORK-INTERFACE]
              else
                vim /etc/sysconfig/network-scripts/ifcfg-$1
              fi
            }
            
            function showi() {
              if [ -z $1 ]
              then
                echo Usage: showi [NETWORK-INTERFACE]
              else
                cat /etc/sysconfig/network-scripts/ifcfg-$1
              fi
            }

            function expose() {
              if [ -z $1 ]
              then
                echo Usage: expose [PORT]
              else
                sudo firewall-cmd --permanent --add-port=$1/tcp
                sudo firewall-cmd --reload
              fi
            }

            function block() {
              if [ -z $1 ]
              then
                echo Usage: block [PORT]
              else
                sudo firewall-cmd --permanent --remove-port=$1/tcp
                sudo firewall-cmd --reload
              fi
            }

            alias allowed="sudo firewall-cmd --list-all"
    
    - name: Configure bash prompt configurations
      block: 
        - name: Download remote bash configurations
          git:
            repo: https://github.com/amirsil/pureline
            dest: /root/pureline

        - name: Activate bash configurations
          copy: 
            src: /root/pureline/configs/powerline_basic_8col.conf
            dest: /root/.pureline.conf
            remote_src: yes
      rescue:
        - debug:
            msg: Cannot fetch remote bash configurations, Git is not installed
